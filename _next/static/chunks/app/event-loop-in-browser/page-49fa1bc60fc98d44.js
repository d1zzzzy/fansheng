(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{4259:(e,t,c)=>{Promise.resolve().then(c.bind(c,4073))},4073:(e,t,c)=>{"use strict";c.r(t),c.d(t,{default:()=>m});var r=c(7572),s=c(5400),n=c(2553),o=c(9510),a=c(9651),l=c(2742),u=c(1036);c(2106);let i='\nconsole.log("Start");\n\nsetTimeout(() => {\n  console.log("setTimeout Task");\n}, 0);\n\nPromise.resolve().then(() => {\n  console.log("Promise Microtask");\n});\n\nfetch("https://jsonplaceholder.typicode.com/todos/1")\n  .then(() => console.log("Fetch Microtask"));\n\nconsole.log("End");\n';function m(){let e=(0,s.useRef)(null),t=(0,s.useRef)(null),c=(0,s.useRef)(null),m=(0,s.useRef)(null),d=(0,s.useRef)(null),h=a.$t.create({doc:i,extensions:[n.oQ,(0,l.Q2)()]}),[x]=(0,s.useState)(h),[f,p]=(0,s.useState)(null),g=(0,s.useRef)([]),N=(0,s.useRef)([]),k=(0,s.useRef)([]),j=(0,s.useRef)([]),E=(0,s.useRef)([]),v=(0,s.useCallback)(()=>{j.current=[],k.current=[],N.current=[],E.current.forEach(clearTimeout),Function("setTimeout","fetch","Promise","console",i)(e=>{k.current=[...k.current,{message:"setTimeout",callback:e,source:"setTimeout"}]},function(){for(var e=arguments.length,t=Array(e),c=0;c<e;c++)t[c]=arguments[c];return{then:e=>{k.current=[...k.current,{message:"fetch(".concat(t[0],")"),callback:()=>{N.current=[...N.current,{message:"fetch.then",callback:e,source:"fetch.then"}]},source:"fetch"}]}}},{resolve:()=>({then:e=>{N.current=[...N.current,{message:"Promise.then",callback:e,source:"Promise"}]}})},{log:e=>{g.current=[...g.current,"console.log"],j.current=[...j.current,{message:e,type:"sync",source:"console"}]}}),console.log("========> 执行完毕"),console.log(N,k,j),b()},[]),T=()=>{t.current&&(t.current.innerHTML="",g.current.forEach(e=>{let c=document.createElement("div");c.textContent=e,c.className="stack-item",t.current.appendChild(c)}))},y=()=>{c.current&&m.current&&(c.current.innerHTML="",m.current.innerHTML="",N.current.forEach((e,t)=>{let r=document.createElement("div");r.textContent="Microtask ".concat(t+1,": ").concat(e.message),r.className="task micro",c.current.appendChild(r)}),k.current.forEach((e,t)=>{let c=document.createElement("div");c.textContent="Macrotask ".concat(t+1,": ").concat(e.message),c.className="task macro",m.current.appendChild(c)}))},C=()=>{d.current&&(d.current.innerHTML="",j.current.forEach(e=>{let t=document.createElement("div");t.textContent=e.message,t.className="task ".concat(e.type),d.current.appendChild(t)}))},b=()=>{g.current.forEach(e=>{j.current=[...j.current,{message:e,type:"async",source:"callStack"}],T(),C()}),N.current.forEach(e=>{let{message:t,callback:c}=e;j.current=[...j.current,{message:t,type:"async",source:"microtasks"}],c(),y()}),N.current=[],k.current.forEach(e=>{let{message:t,callback:c}=e;j.current=[...j.current,{message:t,type:"async",source:"macrotasks"}],c(),y()}),k.current=[],E.current.forEach(e=>{j.current=[...j.current,{message:"setTimeout",type:"async",source:"timers"}],clearTimeout(e),y()}),E.current=[]};return(0,s.useLayoutEffect)(()=>{e.current&&p(new o.Lz({state:x,parent:e.current}))},[x]),(0,s.useEffect)(()=>()=>{null==f||f.destroy(),E.current.forEach(clearTimeout)},[f]),(0,r.jsxs)("main",{className:"page p-24 border-box",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-center",children:"Event Loop in Browser"}),(0,r.jsxs)("section",{className:"content mx-auto grid grid-col-2 gap-16 p-t-12",children:[(0,r.jsxs)("div",{className:"relative shadow-sm rounded-lg p-12",children:[(0,r.jsx)("div",{ref:e}),(0,r.jsx)(u.A,{className:"absolute pointer right-40 bottom-40",titleAccess:"Run Code",onClick:v})]}),(0,r.jsxs)("div",{className:"preview-box shadow-sm rounded-lg p-12",children:[(0,r.jsxs)("section",{className:"execute-section call-stack",children:[(0,r.jsx)("p",{className:"execute-title",children:"Call Stack"}),(0,r.jsx)("div",{className:"execute-content",ref:t})]}),(0,r.jsxs)("section",{className:"grid grid-col-2 gap-16 mt-24",children:[(0,r.jsxs)("section",{className:"execute-section task",children:[(0,r.jsx)("p",{className:"execute-title",children:"Macro Task"}),(0,r.jsx)("div",{className:"execute-content",ref:m})]}),(0,r.jsxs)("section",{className:"execute-section micro-task",children:[(0,r.jsx)("p",{className:"execute-title",children:"Micro Task"}),(0,r.jsx)("div",{className:"execute-content",ref:c})]})]}),(0,r.jsxs)("section",{className:"execute-log mt-24",children:[(0,r.jsx)("p",{className:"execute-title",children:"Logs"}),(0,r.jsx)("div",{className:"execute-content",ref:d})]})]})]})]})}},2106:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[405,599,809,639,4,631,358],()=>t(4259)),_N_E=e.O()}]);