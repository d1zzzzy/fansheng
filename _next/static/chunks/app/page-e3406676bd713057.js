(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4803:(t,e,i)=>{Promise.resolve().then(i.bind(i,4543))},4543:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>x});var a=i(4001),n=i(7749);class s{static drawPoint(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.beginPath(),t.arc(e.x,e.y,i.lineWidth||1,0,2*Math.PI),t.fillStyle=i.color||"black",t.fill()}static drawLine(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.strokeStyle=a.color||"black",t.lineWidth=a.lineWidth||1,t.stroke()}static drawArc(t,e,i,a,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};t.beginPath(),t.arc(e.x,e.y,i,a,n),t.strokeStyle=s.color||"black",t.lineWidth=s.lineWidth||1,t.stroke()}static drawRect(t,e,i,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};t.beginPath(),t.rect(e.x,e.y,i,a),t.strokeStyle=n.color||"black",t.lineWidth=n.lineWidth||1,t.stroke()}static clearCanvas(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-t.canvas.width,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-t.canvas.height,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*t.canvas.width,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*t.canvas.height;t.clearRect(e,i,a,n)}static updateDpr(){void 0===this._dpr&&(this._dpr=window.devicePixelRatio||1)}static get dpr(){return this.updateDpr(),this._dpr}}function r(t,e){t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="".concat(e.clientWidth,"px"),t.style.height="".concat(e.clientHeight,"px")}function h(t,e,i){let a=Math.cos(e),n=Math.sin(e);return{x:a*(t.x-i.x)-n*(t.y-i.y)+i.x,y:n*(t.x-i.x)+a*(t.y-i.y)+i.y}}s._dpr=void 0;class l{initialize(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}resizeCanvas(t,e){var i,a,n,s,r;let h=e.width||t.clientWidth,l=e.height||t.clientHeight,o=null===(i=this.context)||void 0===i?void 0:i.getImageData(0,0,this.canvas.width,this.canvas.height);this.canvas.width=h*this.dpr,this.canvas.height=l*this.dpr,this.canvas.style.width="".concat(h,"px"),this.canvas.style.height="".concat(l,"px"),this.offscreenCanvas.width=this.canvas.width,this.offscreenCanvas.height=this.canvas.height,this.animationCanvas.width=this.canvas.width,this.animationCanvas.height=this.canvas.height,null===(a=this.context)||void 0===a||a.setTransform(this.dpr,0,0,-this.dpr,this.canvas.width/2,this.canvas.height/2),null===(n=this.offscreenContext)||void 0===n||n.setTransform(this.dpr,0,0,-this.dpr,this.offscreenCanvas.width/2,this.offscreenCanvas.height/2),null===(s=this.animationContext)||void 0===s||s.setTransform(this.dpr,0,0,-this.dpr,this.animationCanvas.width/2,this.animationCanvas.height/2),o&&(null===(r=this.context)||void 0===r||r.putImageData(o,0,0))}resize(t,e){this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr}render(){this.context&&this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)}destroy(){var t;null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.resizeObserver=null,this.stopAnimation(),this.context=null,this.canvas=null,this.offscreenCanvas=null,this.animationCanvas=null,this.animationFrameId=null}drawLine(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s.drawLine(this.context,t,e,i)}drawAnimateLine(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Promise(n=>{let r=this.offscreenContext,h=this.animationContext;if(a<=0){var l;s.drawLine(r,t,e,i),null===(l=this.context)||void 0===l||l.drawImage(this.offscreenCanvas,-this.canvas.width/2,-this.canvas.height/2),n();return}let o=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),c=o/(a/16.67),d=0,v={x:(t.x+e.x)/2,y:(t.y+e.y)/2},g=t=>Math.round(t)+.5,u=()=>{if(d<o/2){let a=d/(o/2),n={x:g(v.x-(v.x-t.x)*a),y:g(v.y-(v.y-t.y)*a)},r={x:g(v.x+(e.x-v.x)*a),y:g(v.y+(e.y-v.y)*a)};s.clearCanvas(h),s.drawLine(h,n,r,i),d+=c,requestAnimationFrame(u)}else s.drawLine(this.context,t,e,i),s.clearCanvas(h),n()};u()})}drawArc(t,e,i,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};s.drawArc(this.context,t,e,i,a,n)}drawPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.drawPoint(this.context,t,e)}drawRect(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};s.drawRect(this.context,t,e,i,a)}drawText(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=0,s=setInterval(()=>{var i,r,h;this.clear(),null===(i=this.offscreenContext)||void 0===i||i.clearRect(-this.offscreenCanvas.width/2,-this.offscreenCanvas.height/2,this.offscreenCanvas.width,this.offscreenCanvas.height),this.offscreenContext.fillStyle=a.color||"black",this.offscreenContext.font="".concat(((null==a?void 0:a.fontSize)||16)*this.dpr,"px ").concat(a.font||"Arial"),null===(r=this.offscreenContext)||void 0===r||r.fillText(e.slice(0,n+1),t.x,t.y),null===(h=this.context)||void 0===h||h.drawImage(this.offscreenCanvas,-this.canvas.width/2,-this.canvas.height/2),++n>=e.length&&clearInterval(s)},i)}animate(t){let e=i=>{t(i),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopAnimation(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}clear(){var t;null===(t=this.context)||void 0===t||t.clearRect(-this.canvas.width/2,-this.canvas.height/2,this.canvas.width,this.canvas.height)}clearCanvas(){this.clear()}moveLine(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Promise(r=>{let h=this.animationContext;if(a<=0){r();return}let l=performance.now(),o=0,c=d=>{let v=Math.min((d-l)/a,1),g=n*v,u=Math.min(t.x,e.x)-10,m=Math.min(t.y,e.y)-10+o,f=Math.max(t.x,e.x)+10,x=Math.max(t.y,e.y)+10+g;s.clearCanvas(h,u,m,f-u,x-m);let w={x:t.x,y:t.y+o},y={x:e.x,y:e.y+g};if(s.drawLine(h,w,y,i),o=g,v<1)requestAnimationFrame(c);else{let a={x:t.x,y:t.y+n},l={x:e.x,y:e.y+n};s.drawLine(this.context,a,l,i),s.clearCanvas(h),r()}};requestAnimationFrame(c)})}moveLines(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0];return new Promise(n=>{Promise.all(t.map((t,n)=>this.moveLine(t.start,t.end,e,i,a[n]))).then(()=>{n()})})}rotateLine(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Promise(n=>{let r=this.animationContext;if(i<=0){n();return}let l=performance.now(),o=c=>{var d,v,g,u;let m=Math.min((c-l)/i,1),f=a*m*Math.PI/180,x={x:(t.start.x+t.end.x)/2,y:(t.start.y+t.end.y)/2},w=h(t.start,f,null!==(d=t.rotateAt)&&void 0!==d?d:x),y=h(t.end,f,null!==(v=t.rotateAt)&&void 0!==v?v:x);if(s.clearCanvas(r),s.drawLine(r,w,y,e),m<1)requestAnimationFrame(o);else{let i=h(t.start,f,null!==(g=t.rotateAt)&&void 0!==g?g:x),a=h(t.end,f,null!==(u=t.rotateAt)&&void 0!==u?u:x);s.clearCanvas(r),s.drawLine(this.context,i,a,e),n()}};requestAnimationFrame(o)})}rotateLines(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Promise(n=>{let r=this.animationContext;if(i<=0){n();return}let l=performance.now(),o=c=>{let d=Math.min((c-l)/i,1),v=a*d*Math.PI/180;s.clearCanvas(r),t.forEach(t=>{var i,a;let n={x:(t.start.x+t.end.x)/2,y:(t.start.y+t.end.y)/2},h=(t,e,i)=>{let a=Math.cos(e),n=Math.sin(e);return{x:a*(t.x-i.x)-n*(t.y-i.y)+i.x,y:n*(t.x-i.x)+a*(t.y-i.y)+i.y}},l=h(t.start,v,null!==(i=t.rotateAt)&&void 0!==i?i:n),o=h(t.end,v,null!==(a=t.rotateAt)&&void 0!==a?a:n);s.drawLine(r,l,o,e)}),d<1?requestAnimationFrame(o):(t.forEach(t=>{var i,a;let n={x:(t.start.x+t.end.x)/2,y:(t.start.y+t.end.y)/2},r=h(t.start,v,null!==(i=t.rotateAt)&&void 0!==i?i:n),l=h(t.end,v,null!==(a=t.rotateAt)&&void 0!==a?a:n);s.drawLine(this.context,r,l,e)}),s.clearCanvas(r),n())};requestAnimationFrame(o)})}constructor(t,e={}){if(this.canvas=null,this.context=null,this.offscreenCanvas=null,this.offscreenContext=null,this.animationCanvas=null,this.animationContext=null,this.animationFrameId=null,this.resizeObserver=null,this.dpr=window.devicePixelRatio||1,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),!this.context)throw Error("Canvas 2D context is not supported");if(this.offscreenCanvas=document.createElement("canvas"),this.offscreenContext=this.offscreenCanvas.getContext("2d"),!this.offscreenContext)throw Error("Offscreen Canvas context is not supported");if(this.animationCanvas=document.createElement("canvas"),this.animationContext=this.animationCanvas.getContext("2d"),!this.animationContext)throw Error("Animation Canvas context is not supported");this.canvas.setAttribute("id","main-canvas"),this.animationCanvas.setAttribute("id","animation-canvas"),t.appendChild(this.canvas),t.appendChild(this.animationCanvas),this.resizeCanvas(t,e),r(this.canvas,t),r(this.animationCanvas,t),this.resizeObserver=new ResizeObserver(()=>this.resizeCanvas(t,e)),this.resizeObserver.observe(t)}}var o=i(2260);class c{initialize(t,e){if(this.gl=this.canvas.getContext("webgl",{antialias:!0}),this.resizeCanvas(t,{}),!this.gl)throw Error("Failed to initialize WebGL context");this.gl.clearColor(.941,1,.98,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.initShaders(),this.initBuffers(),console.log("WebGL Renderer with Cube initialized")}resize(t,e){if(!this.gl)return;let i=window.devicePixelRatio||1;this.gl.canvas.width=t*i,this.gl.canvas.height=e*i,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),console.log("Canvas size:",this.canvas.width,this.canvas.height),console.log("Device pixel ratio:",window.devicePixelRatio)}resizeCanvas(t,e){if(!this.gl)return;let i=window.devicePixelRatio||1;this.canvas.width=t.clientWidth*i,this.canvas.height=t.clientHeight*i,this.canvas.style.width="".concat(t.clientWidth,"px"),this.canvas.style.height="".concat(t.clientHeight,"px"),this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),console.log("Canvas size:",this.canvas.width,this.canvas.height),console.log("Device pixel ratio:",window.devicePixelRatio)}render(){this.gl&&this.program&&(this.setProjectionMatrix(),this.setViewMatrix(),this.setModelMatrix(),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices.length/3))}destroy(){this.gl&&(this.program&&this.gl.deleteProgram(this.program),this.vertexBuffer&&this.gl.deleteBuffer(this.vertexBuffer),this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)),this.gl=null,this.program=null,this.vertexBuffer=null,this.indexBuffer=null}createShader(t,e){let i=this.gl.createShader(t);return(this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))?i:(console.error(this.gl.getShaderInfoLog(i)),this.gl.deleteShader(i),null)}createProgram(t,e){let i=this.createShader(this.gl.VERTEX_SHADER,t),a=this.createShader(this.gl.FRAGMENT_SHADER,e),n=this.gl.createProgram();return(this.gl.attachShader(n,i),this.gl.attachShader(n,a),this.gl.linkProgram(n),this.gl.getProgramParameter(n,this.gl.LINK_STATUS))?n:(console.error(this.gl.getProgramInfoLog(n)),this.gl.deleteProgram(n),null)}initShaders(){let t=this.createProgram("\n      attribute vec3 a_Position;\n      attribute vec3 a_Color;\n      varying vec3 v_Color;\n\n      uniform mat4 uProjection; // 投影矩阵\n      uniform mat4 uView;       // 视图矩阵\n      uniform mat4 uModel;      // 模型矩阵\n\n      void main() {\n        gl_Position = uProjection * uView * uModel * vec4(a_Position, 1.0);\n        v_Color = a_Color;\n      }\n    ","\n      precision mediump float;\n      varying vec3 v_Color;\n      void main() {\n        gl_FragColor = vec4(v_Color, 1.0);\n      }\n    ");this.gl.useProgram(t),this.program=t}initBuffers(){let{vertices:t,colors:e}=function(){let t=[[1,0,0],[0,1,0],[0,0,1],[1,1,0],[1,0,1],[0,1,1]],e=[],i=[];for(let a=-1;a<=1;a++)for(let n=-1;n<=1;n++)for(let s=-1;s<=1;s++){let r=1.1*a,h=1.1*n,l=1.1*s;for(let a=0;a<6;a++){let n=t[a],s=function(t,e,i,a,n){let s=[];switch(n){case 0:s=[[t-.45,e-.45,i+.45],[t+.45,e-.45,i+.45],[t+.45,e+.45,i+.45],[t-.45,e-.45,i+.45],[t+.45,e+.45,i+.45],[t-.45,e+.45,i+.45]];break;case 1:s=[[t-.45,e-.45,i-.45],[t+.45,e-.45,i-.45],[t+.45,e+.45,i-.45],[t-.45,e-.45,i-.45],[t+.45,e+.45,i-.45],[t-.45,e+.45,i-.45]];break;case 2:s=[[t-.45,e+.45,i-.45],[t+.45,e+.45,i-.45],[t+.45,e+.45,i+.45],[t-.45,e+.45,i-.45],[t+.45,e+.45,i+.45],[t-.45,e+.45,i+.45]];break;case 3:s=[[t-.45,e-.45,i-.45],[t+.45,e-.45,i-.45],[t+.45,e-.45,i+.45],[t-.45,e-.45,i-.45],[t+.45,e-.45,i+.45],[t-.45,e-.45,i+.45]];break;case 4:s=[[t-.45,e-.45,i-.45],[t-.45,e+.45,i-.45],[t-.45,e+.45,i+.45],[t-.45,e-.45,i-.45],[t-.45,e+.45,i+.45],[t-.45,e-.45,i+.45]];break;case 5:s=[[t+.45,e-.45,i-.45],[t+.45,e+.45,i-.45],[t+.45,e+.45,i+.45],[t+.45,e-.45,i-.45],[t+.45,e+.45,i+.45],[t+.45,e-.45,i+.45]]}return s.flat()}(r,h,l,0,a);e.push(...s);for(let t=0;t<6;t++)i.push(...n)}}return{vertices:new Float32Array(e),colors:new Float32Array(i)}}(),i=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW);let a=this.gl.getAttribLocation(this.program,"a_Position");this.gl.vertexAttribPointer(a,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(a);let n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW);let s=this.gl.getAttribLocation(this.program,"a_Color");this.gl.vertexAttribPointer(s,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(s),this.gl.drawArrays(this.gl.TRIANGLES,0,t.length/3),this.buffers={vertexBuffer:i,colorBuffer:n},this.vertices=t,this.colors=e}setProjectionMatrix(){let t=o.vt();o.fN(t,Math.PI/4,this.canvas.clientWidth/this.canvas.clientHeight,.1,500);let e=this.gl.getUniformLocation(this.program,"uProjection");e&&this.gl.uniformMatrix4fv(e,!1,t)}setViewMatrix(){let t=o.vt(),e=[this.cameraDistance*Math.sin(this.cameraAngleY)*Math.cos(this.cameraAngleX),this.cameraDistance*Math.sin(this.cameraAngleX),this.cameraDistance*Math.cos(this.cameraAngleY)*Math.cos(this.cameraAngleX)],i=new Float32Array([0,1,0]);o.t5(t,new Float32Array(e),new Float32Array([0,0,0]),i);let a=this.gl.getUniformLocation(this.program,"uView");a&&this.gl.uniformMatrix4fv(a,!1,t)}setModelMatrix(){let t=o.vt();o.eL(t,t,this.cameraAngleX),o.Z8(t,t,this.cameraAngleY);let e=this.gl.getUniformLocation(this.program,"uModel");e&&this.gl.uniformMatrix4fv(e,!1,t)}addMouseEvents(){let t=!1,e=0,i=0;this.canvas.addEventListener("mousedown",a=>{t=!0,e=a.clientX,i=a.clientY}),this.canvas.addEventListener("mousemove",a=>{if(!t)return;let n=a.clientX-e,s=a.clientY-i;e=a.clientX,i=a.clientY,this.cameraAngleY+=.01*n,this.cameraAngleX+=.01*s,this.render()}),this.canvas.addEventListener("mouseup",()=>{t=!1}),this.canvas.addEventListener("wheel",t=>{this.cameraDistance+=.05*t.deltaY,this.cameraDistance=Math.max(5,Math.min(500,this.cameraDistance)),this.render()})}constructor(t){this.gl=null,this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.buffers={vertexBuffer:null,colorBuffer:null,lineBuffer:null},this.vertices=new Float32Array([]),this.colors=new Float32Array([]),this.cameraAngleX=0,this.cameraAngleY=0,this.cameraDistance=15.4,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","gl-canvas"),t.appendChild(this.canvas),r(this.canvas,t),this.addMouseEvents()}}class d{swithTo2D(){this.setRenderer(new l(this.container))}swithToWebGL(){this.setRenderer(new c(this.container))}setRenderer(t){this._renderer&&this._renderer.destroy(),this._renderer=t,this._renderer.initialize(this.container,{})}get renderer(){return this._renderer}resize(t,e){this._renderer&&this._renderer.resize(t,e)}render(){this._renderer&&this._renderer.render()}constructor(t){this._renderer=null,this.container=t}}let v={color:"#012622ff",lineWidth:1};async function g(t){let e=t.renderer,i={x:0,y:0};(function(t,e){t.renderer.drawPoint(e,v)})(t,i),await u(t,i),e.clear(),await m(t,i),await f(t,i)}async function u(t,e){let i=t.renderer,a={x:e.x-150,y:e.y},n={x:e.x+150,y:e.y};await i.drawAnimateLine(a,n,v,600)}async function m(t,e){let i=t.renderer,a=[,,,,].fill({start:{x:e.x-150,y:e.y},end:{x:e.x+150,y:e.y}}),n=[1.5,.5,-.5,-1.5].map(t=>100*t);await i.moveLines(a,v,600,n)}async function f(t,e){let i=t.renderer,a={x:e.x-150,y:e.y},n={x:e.x+150,y:e.y},s=[1.5,.5,-.5,-1.5].map(t=>100*t).map(t=>({start:{x:a.x,y:a.y+t},end:{x:n.x,y:n.y+t},rotateAt:{x:0,y:0}}));await i.rotateLines(s,v,600,90)}function x(){return(0,n.useEffect)(()=>{let t=new d(document.getElementById("canvas-container"));t.swithTo2D(),g(t),setTimeout(()=>{t.swithToWebGL(),t.render()},1800)},[]),(0,a.jsx)("div",{className:"w-full h-full",children:(0,a.jsx)("div",{className:"canvas-container w-full h-full",id:"canvas-container"})})}}},t=>{var e=e=>t(t.s=e);t.O(0,[260,142,767,358],()=>e(4803)),_N_E=t.O()}]);